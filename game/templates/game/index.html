{% load static %}
<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Django Wordle</title>
    <link rel="stylesheet" href="{% static 'game/style.css' %}">
</head>
<body>

    <div class="game-container">
        <h1>WORDLE</h1>
        
        <div class="grid" id="grid">
            </div>

        <div class="input-area">
            <input type="text" id="guessInput" maxlength="5" autocomplete="off" placeholder="Napi코 slovo...">
            <button id="submitBtn">H츼DAT</button>
        </div>
    </div>

    <script>
        const csrftoken = "{{ csrf_token }}";
        const grid = document.getElementById('grid');
        const input = document.getElementById('guessInput');
        const btn = document.getElementById('submitBtn');
        let currentRow = 0;

        // 1. Generov치n칤 m콏칤쬶y (6 콏치dk콢 po 5 sloupc칤ch)
        for (let r = 0; r < 6; r++) {
            const row = document.createElement('div');
            row.classList.add('row');
            for (let c = 0; c < 5; c++) {
                const tile = document.createElement('div');
                tile.classList.add('tile');
                tile.id = `tile-${r * 5 + c}`;
                row.appendChild(tile);
            }
            grid.appendChild(row);
        }

        // 2. Funkce pro odesl치n칤 pokusu
        async function submitGuess() {
            const guess = input.value.toUpperCase();
            if (guess.length !== 5) return;

            const response = await fetch("{% url 'check_guess' %}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken
                },
                body: JSON.stringify({ guess })
            });

            const data = await response.json();

            if (data.error) {
                alert(data.error);
                return;
            }

            // Obarven칤 dla쬯ic s m칤rn칳m zpo쬯캩n칤m (efekt postupn칠ho odkr칳v치n칤)
            data.result.forEach((status, i) => {
                const tile = document.getElementById(`tile-${currentRow * 5 + i}`);
                setTimeout(() => {
                    tile.textContent = guess[i];
                    tile.classList.add(status);
                    tile.classList.add('flip'); // P콏id치me t콏칤du pro animaci
                }, i * 200);
            });

            if (data.win) {
                setTimeout(() => alert("Geni치ln칤! Vyhr치l jsi! 游꿀"), 1200);
            } else if (currentRow === 5) {
                setTimeout(() => alert("Bohu쬰l, pokusy do코ly."), 1200);
            }

            currentRow++;
            input.value = '';
        }

        // Event listenery
        btn.addEventListener('click', submitGuess);
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') submitGuess();
        });
    </script>
</body>
</html>